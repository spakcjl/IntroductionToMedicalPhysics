---
title: "MRI Physics I: The Fundamentals of Nuclear Magnetic Resonance"
author: "Professor Jules"
date: "`r Sys.Date()`"
output: powerpoint_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 8, fig.height = 6)
library(reticulate)
# It's good practice to specify which python to use.
# In this environment, the system python is at /usr/bin/python3
use_python("/usr/bin/python3")
```

---

# Module 1: The Hardware & The Proton

---

## The Magic of Magnetic Resonance

*   MRI acts as a giant magnet producing pictures of the body's interior.
*   It differs significantly from X-ray, CT, PET, and ultrasound modalities.
*   The technology relies on the quantum mechanical properties of atomic nuclei.
*   The goal is to provide intuition for how magnets and nuclei interact to create images.

::: notes
"Simply put, an MRI scanner is a giant magnet that can produce pictures of the inside of the body. But how does it do this? Why is it so loud, long, and expensive? This presentation explains the heart of the technology: Nuclear Magnetic Resonance (NMR)."
:::

---

## The 30,000-Foot View of NMR

*   **Step 1:** Nuclei align with a strong magnetic field like compass needles.
*   **Step 2:** A radiofrequency (RF) pulse knocks nuclei out of alignment.
*   **Step 3:** Nuclei precess and emit their own RF signal, which the scanner detects.
*   **Step 4:** Nuclei eventually realign with the field (Relaxation).

::: notes
"First, atomic nuclei behave like tiny bar magnets and align with the field. We send in a radio pulse to knock them over. As they spin (or precess), they give off a signal we detect. Eventually, they relax back to alignment. We repeat this over and over to build an image."
:::

---

## Inside the Scanner (The Hardware)

*   **Main Magnet (Purple):** A superconducting magnet (always on!) creating a strong, homogeneous B0 field (10k-100k times Earth's field).
*   **Gradient Coils (Green):** Coils that alter the magnetic field in X, Y, and Z for signal localization and contrast.
*   **RF Coils (Inner Layer):** Antennas that transmit the "tipping" pulse and receive the resulting signal from the tissue.

::: notes
"Ideally, think of the scanner as three nested layers. The outer layer is the main magnet—essentially 90% of the machine. Inside are gradient coils for localization, and the innermost layer contains RF coils to send signals and listen for echoes."
:::

---

## The Ideal Candidate: Hydrogen

*   The body is approximately 70% water, meaning there are two hydrogen atoms for every water molecule.
*   Hydrogen nuclei are single protons with a high gyromagnetic ratio.
*   "Proton imaging" is a misnomer; we are specifically looking at hydrogen nuclei.

::: notes
"We could look at many elements, but hydrogen is the winner. It's in nearly every organ, and because the body is mostly water, we have an enormous number of hydrogen atoms to work with."
:::

---

## Spin Physics & Precession

*   **Spin:** Provides intrinsic angular momentum and a magnetic moment (tiny bar magnet behavior).
*   **Torque:** The external magnetic field tries to align the proton, but due to spin, it precesses instead.
*   **Analogy:** This motion is identical to a spinning top precessing under the force of gravity.

::: notes
"The proton has a property called spin. When you try to force a spinning object to align, it doesn't just fall over; it precesses. Think of a spinning top fighting gravity—that is exactly what our protons do in the magnetic field."
:::

---

## Lenz’s Law & Signal Detection

*   A precessing proton creates a changing magnetic flux through the nearby RF coil.
*   **Lenz’s Law:** Changing magnetic flux induces a voltage in a wire.
*   The detected signal is sinusoidal, oscillating at the precession frequency.

::: notes
"How do we actually 'hear' the protons? Lenz’s Law. As the magnetic moment sweeps past our coil, the changing magnetic flux induces a voltage. That voltage is the MRI signal."
:::


---

# Module 2: Signal Generation & Larmor Physics

---

## The Larmor Equation

$$ \omega = \gamma B $$

::: notes
"This is the most important equation in MRI: The Larmor Equation. It's elegant in its simplicity."
:::

---

## The Larmor Equation: Variables

*   **$$ \omega $$ (Omega):** Precession frequency (how fast the protons wobble).
*   **$$ \gamma $$ (Gamma):** Gyromagnetic ratio (a constant specific to the nucleus, for Hydrogen it's 42.58 MHz/T).
*   **$$ B $$:** Magnetic field strength (how strong the magnet is).

::: notes
"It tells us that the precession frequency, omega, is directly proportional to the magnetic field strength, B, scaled by a constant, gamma, which is unique for each type of nucleus."
:::

---

## The Larmor Equation: Intuition

*   The equation shows a simple **linear relationship**.
*   If you double the magnetic field strength, you double the precession frequency.
*   A stronger magnet also leads to a stronger signal, which improves image quality.

::: notes
"The key takeaway is this: a stronger magnet makes the protons spin faster. This not only gives us a higher frequency signal to detect but also increases the signal's amplitude, which is crucial for getting clear images."
:::

---

## Python Code: The Larmor Relationship

```{python larmor_code, echo=TRUE}
import numpy as np
import matplotlib.pyplot as plt

# Define the gyromagnetic ratio for Hydrogen (MHz/T)
gamma = 42.58

# Create a range of magnetic field strengths (B) from 0 to 3 Tesla
b_field = np.linspace(0, 3, 100)
frequency = gamma * b_field

# Create the plot
plt.figure(figsize=(8, 6))
plt.plot(b_field, frequency, color="dodgerblue", linewidth=2)
plt.plot(1.5, 1.5 * gamma, 'ro', markersize=8, label="1.5T = 63.9 MHz")
plt.text(1.55, 1.5 * gamma + 5, "1.5T = 63.9 MHz", color="red", fontsize=12)

# Add labels and title
plt.title("The Larmor Relationship for Hydrogen", fontsize=16)
plt.xlabel("Magnetic Field Strength (B) in Tesla", fontsize=12)
plt.ylabel("Precession Frequency (ω) in MHz", fontsize=12)
plt.grid(True)
plt.show()
```

---

## Visual: The Larmor Relationship

```{python larmor_plot, echo=FALSE}
import numpy as np
import matplotlib.pyplot as plt

# Define the gyromagnetic ratio for Hydrogen (MHz/T)
gamma = 42.58

# Create a range of magnetic field strengths (B) from 0 to 3 Tesla
b_field = np.linspace(0, 3, 100)
frequency = gamma * b_field

# Create the plot
plt.figure(figsize=(8, 6))
plt.style.use('seaborn-v0_8-whitegrid')
plt.plot(b_field, frequency, color="dodgerblue", linewidth=2)
plt.plot(1.5, 1.5 * gamma, 'ro', markersize=8)
plt.text(1.55, 1.5 * gamma + 5, "1.5T = 63.9 MHz", color="red", fontsize=12)

# Add labels and title
plt.title("The Larmor Relationship for Hydrogen", fontsize=16)
plt.xlabel("Magnetic Field Strength (B) in Tesla", fontsize=12)
plt.ylabel("Precession Frequency (ω) in MHz", fontsize=12)
plt.show()
```

---

## Factors Influencing Signal Strength

*   **Field Strength ($B$):** Higher fields yield higher frequencies and amplitudes.
*   **Flip Angle ($\theta$):** Signal is maximized when spins are perpendicular (90°) to the main field.
*   **Number of Spins ($N$):** More spins participating results in a stronger collective signal.

::: notes
"What makes our signal louder? A stronger magnet, having more protons (N), and tipping them fully 90 degrees so they are perpendicular to the field. If the angle is small, the signal is small."
:::


---

# Module 3: Relaxation & Tissue Contrast

---

## T2 Relaxation (Signal Decay)

*   Spins begin in sync (coherent) but naturally dephase due to magnetic interactions.
*   **T2:** The time constant describing how quickly the transverse signal dies away.
*   **Short T2:** Solids/semi-solids (bone, lung) decay quickly.
*   **Long T2:** Fluids (water, blood) maintain signal longer.

::: notes
"The protons don't stay in sync forever. They interact with neighbors and dephase. This decay is called T2 relaxation. Water has a long T2 (slow decay), while bone has a short T2 (fast decay)."
:::

---

## Python Code: T2 Decay Comparison

```{python t2_decay_code, echo=TRUE}
import numpy as np
import matplotlib.pyplot as plt

# Time points
t = np.linspace(0, 250, 500)

# T2 values
t2_water = 80
t2_solid = 20

# Signal decay
signal_water = np.exp(-t / t2_water)
signal_solid = np.exp(-t / t2_solid)

# Echo Time (TE)
te = 75

plt.figure(figsize=(8, 6))
plt.plot(t, signal_water, color='royalblue', linewidth=2, label='Water (Long T2)')
plt.plot(t, signal_solid, color='orangered', linewidth=2, label='Solid (Short T2)')
plt.axvline(x=te, color='black', linestyle='--', linewidth=1.5)
plt.text(te + 5, 0.8, f'TE = {te} ms', color='black', fontsize=12)

plt.title('T2 Decay: Tissue Contrast', fontsize=16)
plt.xlabel('Time (ms)', fontsize=12)
plt.ylabel('Transverse Signal Amplitude', fontsize=12)
plt.legend()
plt.grid(True)
plt.show()
```

---

## Visual: T2 Decay Comparison

```{python t2_decay_plot, echo=FALSE}
import numpy as np
import matplotlib.pyplot as plt

# Time points
t = np.linspace(0, 250, 500)

# T2 values
t2_water = 80
t2_solid = 20

# Signal decay
signal_water = np.exp(-t / t2_water)
signal_solid = np.exp(-t / t2_solid)

# Echo Time (TE)
te = 75

plt.figure(figsize=(8, 6))
plt.style.use('seaborn-v0_8-whitegrid')
plt.plot(t, signal_water, color='royalblue', linewidth=2, label='Water (Long T2)')
plt.plot(t, signal_solid, color='orangered', linewidth=2, label='Solid (Short T2)')
plt.axvline(x=te, color='black', linestyle='--', linewidth=1.5)
plt.text(te + 5, 0.8, f'TE = {te} ms', color='black', fontsize=12)

plt.title('T2 Decay: Tissue Contrast', fontsize=16)
plt.xlabel('Time (ms)', fontsize=12)
plt.ylabel('Transverse Signal Amplitude', fontsize=12)
plt.legend()
plt.show()
```

---

## T2 Weighting & TE (Echo Time)

*   **Rotating Frame:** We simplify the math by ignoring the precession rotation (makes the signal look like a simple decay curve).
*   **Echo Time (TE):** The time the scanner waits after excitation to measure the signal.
*   **T2 Weighting:** Waiting for a long TE makes tissues with short T2s (bone) appear dark and long T2s (fluid) appear bright.

::: notes
"If we wait a specific amount of time, called TE, before measuring, we get contrast. At a long TE, the bone signal is gone (dark), but the water signal is still strong (bright). This is a T2-weighted image."
:::

---

## Spin Density Weighting

*   At Time = 0, decay hasn't happened yet.
*   Contrast depends only on $N$ (number of protons).
*   **Spin Density Image:** Produced by using a very short TE and very long TR.
*   Generally offers lower contrast in the brain compared to T1 or T2 weighting.

::: notes
"What if we don't wait? If TE is zero, we just measure how many protons are there. This is a Spin Density image. It's often less useful in the brain because proton density is similar across most brain tissue."
:::

---

## T1 Relaxation (Signal Recovery)

*   **Longitudinal Magnetization:** Grows back along the Z-axis (upward).
*   **T1:** The time constant for how fast magnetization recovers to equilibrium ($M_0$).
*   Follows the math of a "charging capacitor": $$ M_z(t) = M_0 (1 - e^{-t/T1}) $$
*   **TR (Repetition Time):** The time the scanner waits between excitations.

::: notes
"While the signal decays sideways (T2), the magnetism is also growing back upwards (T1). This is like a charging capacitor. The time we wait before knocking them down again is called TR."
:::

---

## Python Code: T1 Recovery Comparison

```{python t1_recovery_code, echo=TRUE}
import numpy as np
import matplotlib.pyplot as plt

# Time points
t = np.linspace(0, 2000, 500)

# T1 values
t1_fat = 250
t1_csf = 1000

# Signal recovery
signal_fat = 1 - np.exp(-t / t1_fat)
signal_csf = 1 - np.exp(-t / t1_csf)

# Repetition Time (TR)
tr = 500

plt.figure(figsize=(8, 6))
plt.plot(t, signal_fat, color='gold', linewidth=2, label='Fat (Short T1)')
plt.plot(t, signal_csf, color='deepskyblue', linewidth=2, label='CSF (Long T1)')
plt.axvline(x=tr, color='black', linestyle='--', linewidth=1.5)
plt.text(tr + 50, 0.2, f'TR = {tr} ms', color='black', fontsize=12)

plt.title('T1 Recovery: Tissue Contrast', fontsize=16)
plt.xlabel('Time (ms)', fontsize=12)
plt.ylabel('Longitudinal Signal Recovery', fontsize=12)
plt.legend()
plt.grid(True)
plt.show()
```

---

## Visual: T1 Recovery Comparison

```{python t1_recovery_plot, echo=FALSE}
import numpy as np
import matplotlib.pyplot as plt

# Time points
t = np.linspace(0, 2000, 500)

# T1 values
t1_fat = 250
t1_csf = 1000

# Signal recovery
signal_fat = 1 - np.exp(-t / t1_fat)
signal_csf = 1 - np.exp(-t / t1_csf)

# Repetition Time (TR)
tr = 500

plt.figure(figsize=(8, 6))
plt.style.use('seaborn-v0_8-whitegrid')
plt.plot(t, signal_fat, color='gold', linewidth=2, label='Fat (Short T1)')
plt.plot(t, signal_csf, color='deepskyblue', linewidth=2, label='CSF (Long T1)')
plt.axvline(x=tr, color='black', linestyle='--', linewidth=1.5)
plt.text(tr + 50, 0.2, f'TR = {tr} ms', color='black', fontsize=12)

plt.title('T1 Recovery: Tissue Contrast', fontsize=16)
plt.xlabel('Time (ms)', fontsize=12)
plt.ylabel('Longitudinal Signal Recovery', fontsize=12)
plt.legend()
plt.show()
```

---

## T1 Weighting & TR

*   **Short TR:** Tissues with long T1s haven't recovered much signal (appear dark).
*   **Fast Recovery (Short T1):** Tissues recover quickly and have high signal (appear bright).
*   T1 and T2 are intrinsic tissue properties; TR and TE are scanner settings.

::: notes
"If we interrupt the recovery early (Short TR), tissues that recover slowly won't have much signal to give. Tissues that recover fast will be bright. This is T1 weighting."
:::

---

## The Excitation Pulse (B1 Field)

*   **B1 Field:** Applied perpendicular to the main field ($B_0$).
*   Must match the resonant frequency ($\omega$) of the nuclei to work.
*   In the rotating frame, B1 appears stationary, torquing the spin down to the transverse plane.

::: notes
"How do we tip the spins? We apply a radio pulse (B1) perpendicular to the main magnet. If the frequency matches perfectly—resonance—the spins tip over into the transverse plane."
:::

---

## The Contrast Summary Matrix

*   **T1-Weighted:** Short TE, Short TR (maximizes T1 differences).
*   **T2-Weighted:** Long TE, Long TR (maximizes decay differences).
*   **Proton Density:** Short TE, Long TR (minimizes both T1 and T2 effects).
*   Short TR / Long TE is rarely used (poor signal/contrast).

::: notes
"This is the recipe for MRI contrast. Short TR and short TE give us T1. Long TR and Long TE give us T2. By changing these timing parameters, we decide what kind of picture we get."
:::

---

## Python Code: The Contrast Matrix

```{python contrast_matrix_code, echo=TRUE}
import numpy as np
import matplotlib.pyplot as plt

# Data
labels = np.array([["T1 Weighted", "Proton Density"], ["Low Signal", "T2 Weighted"]])
colors = np.array([["#0072B2", "#009E73"], ["grey", "#D55E00"]])
x_labels = ["Short TE", "Long TE"]
y_labels = ["Short TR", "Long TR"]

# Plotting
fig, ax = plt.subplots(figsize=(8, 6))
ax.imshow(np.arange(4).reshape(2, 2), cmap=plt.matplotlib.colors.ListedColormap(colors.flatten()))

# Adding text
for i in range(2):
    for j in range(2):
        ax.text(j, i, labels[i, j], ha='center', va='center', color='white', fontsize=14, weight='bold')

ax.set_xticks(np.arange(len(x_labels)))
ax.set_yticks(np.arange(len(y_labels)))
ax.set_xticklabels(x_labels)
ax.set_yticklabels(y_labels)
ax.set_ylim(1.5, -0.5) # Invert y-axis
plt.title("MRI Contrast Recipe", fontsize=16)
plt.show()
```

---

## Visual: The Contrast Matrix

```{python contrast_matrix_plot, echo=FALSE}
import numpy as np
import matplotlib.pyplot as plt

# Data
labels = np.array([["T1 Weighted", "Proton Density"], ["Low Signal", "T2 Weighted"]])
colors = np.array([["#0072B2", "#009E73"], ["grey", "#D55E00"]])
x_labels = ["Short TE", "Long TE"]
y_labels = ["Short TR", "Long TR"]

# Plotting
fig, ax = plt.subplots(figsize=(8, 6))
ax.imshow(np.arange(4).reshape(2, 2), cmap=plt.matplotlib.colors.ListedColormap(colors.flatten()))

# Adding text
for i in range(2):
    for j in range(2):
        ax.text(j, i, labels[i, j], ha='center', va='center', color='white', fontsize=14, weight='bold')

ax.set_xticks(np.arange(len(x_labels)))
ax.set_yticks(np.arange(len(y_labels)))
ax.set_xticklabels(x_labels)
ax.set_yticklabels(y_labels)
ax.set_ylim(1.5, -0.5) # Invert y-axis
plt.title("MRI Contrast Recipe", fontsize=16)
plt.show()
```

---

# Module 4: Advanced Physics & Thermodynamics

---

## Boltzmann Magnetization

*   Quantum mechanics dictates two energy states: Spin Up (lower energy) and Spin Down (higher energy).
*   **Polarization:** The difference in population between the two states.
*   The difference is miniscule: only ~3 per million protons contribute to the signal at clinical field strengths.

::: notes
"Here is the shocking truth: MRI is incredibly inefficient. For every million protons, only about 3 are actually contributing to our signal. We rely on the sheer number of atoms in the body to make it work."
:::

---

## The Boltzmann Equation

$$ P \approx \frac{\gamma \hbar B}{2kT} $$

*   **P:** Polarization (the excess fraction of spins).
*   **$$ \gamma \hbar $$:** Magnetic moment of the proton.
*   **B:** Magnetic field strength.
*   **k:** Boltzmann's constant.
*   **T:** Temperature in Kelvin.

::: notes
"The Boltzmann equation tells us exactly how small that excess is. Polarization is proportional to the magnetic field strength, which is good, but inversely proportional to temperature. This is why the signal is fundamentally limited by thermodynamics."
:::

---

## Python Code: Boltzmann Polarization

```{python boltzmann_code, echo=TRUE}
import matplotlib.pyplot as plt
import numpy as np

total_spins = 1000000
excess = 3
spin_down = (total_spins - excess) / 2
spin_up = (total_spins + excess) / 2

states = ['Spin Down', 'Spin Up']
populations = [spin_down, spin_up]
colors = ['firebrick', 'navy']

fig, ax = plt.subplots(figsize=(8, 6))
bars = ax.bar(states, populations, color=colors, width=0.5)

ax.set_ylabel('Number of Protons')
ax.set_title('Boltzmann Distribution: The Tiny Excess', fontsize=16)
ax.set_ylim(0, spin_up * 1.01)
ax.get_yaxis().set_major_formatter(plt.FuncFormatter(lambda x, p: format(int(x), ',')))

for bar in bars:
    yval = bar.get_height()
    ax.text(bar.get_x() + bar.get_width()/2.0, yval + 5000, f'{yval:,.0f}', ha='center', va='bottom')

plt.show()
```

---

## Visual: Boltzmann Polarization

```{python boltzmann_plot, echo=FALSE}
import matplotlib.pyplot as plt
import numpy as np

total_spins = 1000000
excess = 3
spin_down = (total_spins - excess) / 2
spin_up = (total_spins + excess) / 2

states = ['Spin Down', 'Spin Up']
populations = [spin_down, spin_up]
colors = ['firebrick', 'navy']

fig, ax = plt.subplots(figsize=(8, 6))
plt.style.use('seaborn-v0_8-whitegrid')
bars = ax.bar(states, populations, color=colors, width=0.5)

ax.set_ylabel('Number of Protons')
ax.set_title('Boltzmann Distribution: The Tiny Excess', fontsize=16)
ax.set_ylim(0, spin_up * 1.01)
ax.get_yaxis().set_major_formatter(plt.FuncFormatter(lambda x, p: format(int(x), ',')))

for bar in bars:
    yval = bar.get_height()
    ax.text(bar.get_x() + bar.get_width()/2.0, yval + 5000, f'{yval:,.0f}', ha='center', va='bottom')

plt.show()
```

---

## Visual: Zooming In on the Excess

```{python boltzmann_zoom_plot, echo=FALSE}
import matplotlib.pyplot as plt
import numpy as np

total_spins = 1000000
excess = 3
spin_down = (total_spins - excess) / 2
spin_up = (total_spins + excess) / 2

states = ['Spin Down', 'Spin Up']
populations = [spin_down, spin_up]
colors = ['firebrick', 'navy']

fig, ax = plt.subplots(figsize=(8, 6))
plt.style.use('seaborn-v0_8-whitegrid')
bars = ax.bar(states, populations, color=colors, width=0.5)

ax.set_ylabel('Number of Protons (Zoomed)')
ax.set_title('Zooming In: The Net Magnetization', fontsize=16)
ax.set_ylim(spin_down * 0.99999, spin_up * 1.00001) # Zoom in
ax.get_yaxis().set_major_formatter(plt.FuncFormatter(lambda x, p: format(int(x), ',')))

for bar in bars:
    yval = bar.get_height()
    ax.text(bar.get_x() + bar.get_width()/2.0, yval, f'{yval:,.0f}', ha='center', va='bottom')

plt.show()
```

---

## Hyperpolarization (Breaking the Limit)

*   **Thermal Equilibrium:** Limited by Boltzmann's law (low signal).
*   **Hyperpolarization:** Techniques to align up to 50% of spins (vs. 0.0003%).
*   **Applications:** Inhaled noble gases (He-3, Xe-129) to image lung function and ventilation.

::: notes
"Physicists found a hack. By hyperpolarizing noble gases like Xenon, we can get 50% alignment. This signal is so strong we can image the gas itself inside the lungs to see asthma or obstruction."
:::

---

## Looking Ahead: Spatial Encoding

*   Summary: We understand signal generation and contrast (T1/T2).
*   Next Challenge: How do we know *where* the signal is coming from?.
*   **Preview:** Part 2 will cover Gradients, K-Space, and Fourier Transforms.

::: notes
"We've covered the physics of the signal, but we haven't made an image yet. In the next presentation, we will see how gradients allow us to locate these signals in 3D space using K-Space and Fourier theory."
:::
